---

- hosts: 

  vars:
    application: watchtower

  tasks:
    - name: Create config folder
      ansible.builtin.file:
        path: "{{ config_directory }}"
        state: directory
        owner: "{{ common_user }}"
        group: "{{ common_group }}"
        mode: "0771"

    - name: Create container
      community.docker.docker_container:
        name: "{{ application }}"
        image: ghcr.io/containrrr/watchtower:1.7.1
        state: started
        restart_policy: unless-stopped
        published_ports:
          - "8484:8080/tcp"
        volumes:
          - /etc/localtime:/etc/localtime:ro
          - /var/run/docker.sock:/var/run/docker.sock:ro

        env:
          TZ: "{{ common_timezone }}"
          WATCHTOWER_SCHEDULE: "0 00 17 * * *"
          WATCHTOWER_CLEANUP: "true"
          WATCHTOWER_REMOVE_VOLUMES: "true"
          WATCHTOWER_HTTP_API_METRICS: "true"
          WATCHTOWER_HTTP_API_TOKEN: !vault |
            $ANSIBLE_VAULT;1.1;AES256
            33336538636436643164343437656238613431316530333239393961643236323831316133323537
            3335343636393065646661643432623966363434333466360a613833303161353032613562633739
            61646434623835326536313132383237363766326337393661623535376264613130313332616163
            3235333535653830310a303330383266613831376666363230313730363739653837303061646232
            39346165643238666536386662333837363732643332666364373439653634616166646237646363
            33396565353934626435313032353438326132653138653533623335376334633761323639353830
            32636435636139326161623238316665356664626665646131376162326638313063383631373539
            65633431336564356134
          

          ## SLACK SETTINGS
          WATCHTOWER_NOTIFICATIONS: "slack"
          WATCHTOWER_NOTIFICATION_SLACK_IDENTIFIER: watchtower
          WATCHTOWER_NOTIFICATION_SLACK_HOOK_URL: !vault |
            $ANSIBLE_VAULT;1.1;AES256
            34313063323135363039623131316639386337366165666662643439386562653732326339613737
            3036666534356662646666366132646230396137306537660a666337376232636633363436623539
            37633938643262363764386434636262326161626466333135633966616663383736346266613361
            3337316264653435650a623165396665636465653263346130316336623564396338646538386431
            32656466373463646339336433326438643761656662616438616531303638336632323963343666
            66313162616165613062323765353238316666353333383962663034376438613737643664363134
            37636532343035386165613832336136333132343564383435343231623039653335383434343563
            39373062643630386630396362666266626664616637373166373134336335623766383766633766
            3637



          # ## DISCORD SETTINGS
          # WATCHTOWER_NOTIFICATIONS: "shoutrrr"
          # # WATCHTOWER_NOTIFICATION_IDENTIFIER: "Watchtower"
          # # WATCHTOWER_NOTIFICATION_ICON_URL: "https://raw.githubusercontent.com/containrrr/watchtower/master/logo.png"
          # WATCHTOWER_NOTIFICATION_URL: !vault |
          #   $ANSIBLE_VAULT;1.1;AES256
          #   66326563363863383835613438633662646635613066643236386464373130336365656131653035
          #   3637373161353532383135653939363735363464346238660a653562366537633230653932336333
          #   62663466613236323566383234376339636237626663303936633861613066303336363737653837
          #   6533646537303834300a316366303537396562613066643261663764363161626437353731373835
          #   63613037333731346638343830366361356636323235653337386534373131336438316439616539
          #   38373264373764333336333963626664306631323463333639633366313236663161376264323037
          #   33373066656232373632386565336166663762356662633431626164316138373839373062396263
          #   65363834346363336266386437623366613763323162373536343735346139653764643532316434
          #   32343433653831613433313439643334636663316638336331663762643537633365
